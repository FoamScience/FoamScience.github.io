<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Customize VIM to work efficiently with OpenFOAM - Part 1 « FOAM Science; Doing CFD</title>
  <meta name="description" content="Today, I’m starting new (short) post series suggesting tricks to customize the VIM text editor so it can be used to edit OpenFOAM cases more efficiently.Of c...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://localhost:4000/vim-openfoam-power-part1/">
  <link rel="alternate" type="application/rss+xml" title="FOAM Science; Doing CFD" href="http://localhost:4000/feed.xml" />
   <!-- Analytics -->
 <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create', '','auto');
  ga('send', 'pageview');</script>

  
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
  (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-3635214305281166",
              enable_page_level_ads: true
                    });
    </script>


</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">FOAM Science; Doing CFD</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/">Home</a>
      
        
        <a class="page-link" href="/about/">About</a>
      
        
        <a class="page-link" href="/contact/">Contact</a>
      
        
        <a class="page-link" href="/category/">Category</a>
      
        
        <a class="page-link" href="/tags/">Tags</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">Customize VIM to work efficiently with OpenFOAM - Part 1</h1>
    <p class="post-meta">Aug 27, 2018</p>
  </header>

  <article class="post-content">
    <p>Today, I’m starting new (short) post series suggesting tricks to customize the <strong>VIM</strong> 
text editor so it can be used to edit OpenFOAM cases more efficiently.
Of course, making VIM work optimally with every single piece of software you have
installed through scripting is a bit of “over-kill”; but having it configured properly is crucial.
<!--more--></p>

<blockquote>
  <p>These series of posts are for those who are ready to write some lines of VIML code
to add interesting functionality to VIM (OpenFOAM-wise).</p>
</blockquote>

<ul id="markdown-toc">
  <li><a href="#vim-plugins-for-openfoam" id="markdown-toc-vim-plugins-for-openfoam">VIM Plugins for OpenFOAM</a>    <ul>
      <li><a href="#syntax-highlighting-of-openfoam-dictionaries-in-vim" id="markdown-toc-syntax-highlighting-of-openfoam-dictionaries-in-vim">Syntax Highlighting of OPENFOAM dictionaries in VIM</a></li>
    </ul>
  </li>
  <li><a href="#your-own-vim-scripts" id="markdown-toc-your-own-vim-scripts">Your own VIM scripts</a>    <ul>
      <li><a href="#first-steps-determining-file-types" id="markdown-toc-first-steps-determining-file-types">First steps: Determining file types</a></li>
      <li><a href="#now-we-know-the-filetype-then-what" id="markdown-toc-now-we-know-the-filetype-then-what">Now we know the filetype, then what?</a></li>
    </ul>
  </li>
</ul>

<h2 id="vim-plugins-for-openfoam">VIM Plugins for OpenFOAM</h2>

<p>We can easily customize our VIM installation using our own scripts, sourced in the <code class="highlighter-rouge">.vimrc</code> file. 
The versatility of VIM allows for sharing these scripts between users, we then call the scripts: <em>Plug-ins</em>.</p>

<p>These plugins differ in both their goal and their implementation:</p>
<ul>
  <li>General purpose plugins. Eg. for handling text formatting, VIM configuration.</li>
  <li>File-Type specific plugins. Eg. those which operate only on C source/header files.</li>
  <li>Syntax highlighting. Eg. highlight OpenFOAM keywords in a OpenFOAM dictionary.</li>
  <li>Compiler plugins. Eg. interpret a python script from VIM command line and jump to errors.</li>
</ul>

<p>As OpenFOAM users, we’ll naturally be interested in any C++ related plugins in addition to few
OpenFOAM-specific ones.</p>

<h3 id="syntax-highlighting-of-openfoam-dictionaries-in-vim">Syntax Highlighting of OPENFOAM dictionaries in VIM</h3>

<p>It’s always good to have keyword-specific highlighting of a file; It helps you instantly
catch misspelled keywords, it makes understanding the file easier; and with appropriate
color themes, it makes you feel comfortable while editing the file.</p>

<p>There is already a VIM plugin that takes care of OpenFOAM keywords highlighting 
(Vim-OpenFOAM-syntax). It’s true that the plugin does some weird stuff 
(eg. loading weird files into the buffer list) 
but, in general, it’s good for the job of highlighting OpenFOAM syntax. 
To install it on your system, follow the instructions at 
<a href="https://github.com/effi/vim-OpenFoam-syntax">Vim-OpenFoam-syntax</a> on github, or
the fork for manual installation (not that scary) 
<a href="https://bitbucket.org/shor-ty/vimextensionopenfoam">Vim-Extension-OpenFOAM</a> on bitbucket.</p>

<p>While programming, I usually use a couple of plugins:</p>
<ul>
  <li><em>c-support</em>: to turn VIM into a C/C++ IDE (code snippets … etc).</li>
  <li><em>taglist</em>: to browse source code efficiently</li>
</ul>

<h2 id="your-own-vim-scripts">Your own VIM scripts</h2>

<p>In this blog post, we’ll write a very small VIM script, called <code class="highlighter-rouge">customFoam.vim</code>, 
that is capable of doing a couple of things:</p>

<ul>
  <li>It needs to be aware of the current file’s FileType.</li>
  <li>When the file is of type <code class="highlighter-rouge">foam</code>, VIM should set a couple of things up:
    <ul>
      <li>Changing the path variable for the <code class="highlighter-rouge">:find</code> command so it includes our case’s directory.</li>
      <li>Changing VIM’s current directory to case directory.</li>
    </ul>
  </li>
  <li>At this moment, that’s all, but we’ll add some stuff in the upcoming blog posts.</li>
</ul>

<h3 id="first-steps-determining-file-types">First steps: Determining file types</h3>

<p>There are two common ways to determine a file type for a file:</p>

<ul>
  <li>Use the extension in its same; I call it the <code class="highlighter-rouge">lazy Windows way</code>: for example ,files that have names
ending with <code class="highlighter-rouge">.html</code> are considered HTML files no matter what their content is.</li>
  <li>Take a look at the file’s content then decide; This is the Unix way, which we’ll be
using here: It just means we’ll search the content of a file for the line that says <code class="highlighter-rouge">FoamFile</code>.</li>
</ul>

<p>We are not the first ones who try to detect <code class="highlighter-rouge">foam</code> file type in VIM; the <em>vim-OpenFoam-syntax</em>
plugin already does that. Actually, it assigns different file types for different <code class="highlighter-rouge">foam</code> files.
For example, it sets: 
<code class="highlighter-rouge">ft="foam256_thermodynamicProperties"</code> for <code class="highlighter-rouge">thermodynamicProperties</code> dictionaries, but
in general, its sets the file type to <code class="highlighter-rouge">foam256_general</code>.</p>

<p>Thus, if you have the plugin installed, you already have the required means to detect
<code class="highlighter-rouge">foam</code> file type. However, for the sake of leaning VIM, we’ll illustrate a very quick way to
do it (but not that efficient!).</p>

<p>All what we have to do is to write a small script -which contains only one function- 
searching the first few lines of a file for the keyword <code class="highlighter-rouge">FoamFile</code>. 
This tells VIM that the file is a <code class="highlighter-rouge">OpenFOAM Dictionary File</code>:</p>

<div class="language-vim highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">" Filename: foamFT.vim</span>

<span class="c">" No debug stuff</span>
<span class="c">" Should check if the file type is already set</span>
<span class="c">" But it's OK; just set it again</span>

<span class="k">function</span><span class="p">!</span> SetFoamType<span class="p">()</span>
    <span class="c">" loop through the first 10 lines</span>
    <span class="c">" FoamFile is at line 8 usually</span>
    <span class="k">for</span> nL <span class="k">in</span> range<span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">10</span><span class="p">)</span>
    <span class="c">" match 'FoamFile'</span>
        <span class="k">if</span> <span class="p">(</span>getline<span class="p">(</span>nL<span class="p">)</span> <span class="p">=~</span> <span class="s1">'FoamFile'</span><span class="p">)</span>
            <span class="k">setfiletype</span> foam
            <span class="c">" if file type is set, leave the loop</span>
            <span class="k">break</span>
        <span class="k">endif</span>
    <span class="k">endfor</span>
<span class="k">endfunction</span>

<span class="c">" That's it!</span>
<span class="c">" Now, when to call it?</span>

augroup FOAMFTautocmds
autocmd<span class="p">!</span>
autocmd <span class="nb">BufRead</span> * <span class="k">call</span> SetFoamType<span class="p">()</span>
augroup End
</code></pre></div></div>

<p>To check whether the script works or not; Just execute the ex-command <code class="highlighter-rouge">:set ft</code>
while an OpenFOAM dictionary is loaded. If it works,
the output should say <em>filetype=foam</em>.</p>

<h3 id="now-we-know-the-filetype-then-what">Now we know the filetype, then what?</h3>

<p>Well, <strong>VIM</strong> knows <em>what</em> we are editing, but it doesn’t know <em>where</em> we are editing it.
In fact, it does know the exact path to the current file (try running the ex-command <code class="highlighter-rouge">:pwd</code>): 
VIM considers the startup-directory as your current directory; and to change it, guess what, we 
have to use the <code class="highlighter-rouge">:cd</code> (change directory!) command.</p>

<p>If you invoke VIM from the case directory, you’ll have the advantage of file names auto-
completion in command-line mode; that is, when you type <code class="highlighter-rouge">:e c&lt;TAB&gt;</code>, VIM automatically
completes <em>constant</em> for you. But, if, for example, you invoke it from the system directory
of a case, it won’t know about the files in the other directories (<em>0</em>, <em>constant</em> … etc).</p>

<p>There’s also the super-useful command <code class="highlighter-rouge">:find</code> which finds the specified file in the path
(could include multiple -independent- directories) and then edit it. The desired work-flow can
be summarized as follows: While editing <code class="highlighter-rouge">blockMeshDict</code> in <em>system</em> directory of a case;
type <code class="highlighter-rouge">:find t&lt;TAB&gt;</code>, which instantly expands to <code class="highlighter-rouge">:find transportProperties</code> (Note that
this file is located under <em>constant</em> directory), then, hitting <em>ENTER</em> switches to that file to edit it.</p>

<div class="language-vim highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">" Filename: customFoam.vim</span>

<span class="k">function</span><span class="p">!</span> FOAMSetPathToCaseDir<span class="p">()</span>
    <span class="c">" IF you care only for files in</span>
    <span class="c">" system, 0, and constant, use</span>
    <span class="c">" let caseDir = expand('%:p:h:h')</span>
    <span class="c">" But, I'm a regexp lover, so,</span>
    <span class="c">" Make Vim remember everything in the path until case name.</span>
    <span class="c">" delete everything else!</span>
    <span class="k">let</span> caseDir <span class="p">=</span> expand<span class="p">(</span><span class="s1">'%:p:s?\(\/.*run\/[a-zA-Z1-9\. ]*\)\/.*?\1?'</span><span class="p">)</span>
    <span class="c">" set path to include all subdirs of caseDir.</span>
    <span class="c">" you can also use '=+' instead of '=' to add the caseDir to</span>
    <span class="c">" the default path; but I like it this way.</span>
    exe <span class="s1">'set path='</span><span class="p">.</span>caseDir<span class="p">.</span><span class="s1">'/**'</span>
    <span class="c">" I want to run blockMesh, solvers and other tools</span>
    <span class="c">" Directly in VIM, so change dir to casedir</span>
    exe <span class="s1">'cd '</span><span class="p">.</span>caseDir
<span class="k">endfunction</span>

<span class="c">" This is just incredible</span>

augroup FOAMautocmds
autocmd<span class="p">!</span>
autocmd <span class="nb">FileType</span> foam* <span class="k">call</span> FOAMSetPathToCaseDir<span class="p">()</span>
augroup End
</code></pre></div></div>

<p>Let’s go through that script line-by-line, shall we?</p>
<ul>
  <li>
    <p><code class="highlighter-rouge">function! FOAMSetPathToCaseDir()</code> overwrites any function defined with this name
(Remember, user-defined function names start with a capital letter). <code class="highlighter-rouge">endfunction</code>
denotes the end of function block.</p>
  </li>
  <li>
    <p>All lines preceded with ( <code class="highlighter-rouge">"</code> ) are considered comments.</p>
  </li>
  <li>
    <p>The line <code class="highlighter-rouge">let caseDir = expand('%:p:s?\(\/.*run\/[a-zA-Z1-9\. ]*\)\/.*?\1?')</code> needs
deeper explanation:</p>
    <ol>
      <li>The standard function <code class="highlighter-rouge">let</code> defines Vim Variables (In this case, variables are local
to the user-defined function).</li>
      <li><em>caseDir</em> is the name of our variable (a string). It is local to the function: To use a
global variable inside a function, name it <code class="highlighter-rouge">g:var</code>, to make it available only in this
script, use <code class="highlighter-rouge">s:var</code>, and, in fact, to use a local variable in a function, it should be
called <code class="highlighter-rouge">l:var</code>, but this is tolerated.</li>
      <li>
        <p>The standard function <code class="highlighter-rouge">expand</code> manipulates filenames (shortcut <em>%</em>) and paths to
them, with modifiers:</p>

        <ul>
          <li>
            <p><code class="highlighter-rouge">:p</code> prints the whole absolute path to the file, eg. while editing
<em>blockMeshDict</em>,
 the ex-command <code class="highlighter-rouge">echo expand('%:p')</code> should display something like
<code class="highlighter-rouge">/home/path-to-case/system/blockMeshDict</code>.</p>
          </li>
          <li>
            <p><code class="highlighter-rouge">:h</code> removes the last entry in a path, eg. <code class="highlighter-rouge">echo expand('%:p:h')</code> would display
<code class="highlighter-rouge">/home/path-to-case/system</code></p>
          </li>
          <li>
            <p><code class="highlighter-rouge">:s?pattern?string?</code> acts like the substitute command. <em>pattern</em> is a regular 
expression, and <em>string</em> accepts <strong>back-references</strong>; 
all the power you need in one command.</p>
          </li>
          <li>
            <p>So, the regexp <code class="highlighter-rouge">\(\/.*run\/[a-zA-Z1-9\. ]*\)\/.*</code> remembers everything
from the start of filename to “run” (hopefully, your OpenFOAM cases directory) to
the first directory (that’s the case dir. at least for me). Case Name may contain
alphabet characters, digits, dots and spaces (The last two are really bad
options). The rest of the path is forgotten (eg./system/blockMeshDict).</p>
          </li>
        </ul>
      </li>
    </ol>
  </li>
</ul>

<p>This way, we can find our path to the case no matter what case file we are
editing!</p>

<ul>
  <li>
    <p>In the line <code class="highlighter-rouge">exe 'set path='.caseDir.'/**'</code> , the command <code class="highlighter-rouge">exe</code> (short for <code class="highlighter-rouge">execute</code>) 
executes the following string as an ex-command. Concatenation in VIML is done with a dot, 
and because our <em>caseDir</em> variable is a string, and we are still inside the same function, 
it can be concatenated with other strings. The /** part expands to all sub-directories, to the last
one of them, no matter how many levels of directories the case have.</p>
  </li>
  <li>
    <p>The path variable is set so the <code class="highlighter-rouge">:find</code> command can help us a bit.</p>
  </li>
  <li>
    <p>I like to change the directory to the case dir. so I can run commands directly from
within VIM without worrying about which files I’m editing, or the start-up directory.
For that, we simply use the <code class="highlighter-rouge">:cd</code> ex-command (VIM’s command).</p>
  </li>
</ul>

<p>The function is completed, now, we have to find a way to automate calling it: 
<code class="highlighter-rouge">auto-commands</code>. Simply, we group all of our autocmds in a group called <code class="highlighter-rouge">FOAMautocmds</code>
(Good practice but optional) .</p>

<ul>
  <li>
    <p><code class="highlighter-rouge">autocmd!</code> overwrites previous autocmds of this group (often abbriviated as <code class="highlighter-rouge">au!</code> ).</p>
  </li>
  <li>
    <p>We want to call the function when we open a file of type <code class="highlighter-rouge">foam*</code> (including <code class="highlighter-rouge">foam</code>,
<code class="highlighter-rouge">foam_general</code> … etc), so we write:
<code class="highlighter-rouge">autocmd FileType foam* call FOAMSetPathToCaseDir()</code>
That’s it, source the script in your <code class="highlighter-rouge">.vimrc</code> file and you are good to test it out:</p>
  </li>
  <li>From the shell (from /../constant/polyMesh in an arbitrary OpenFOAM case, where the
mesh is present) run <code class="highlighter-rouge">vim boundary</code></li>
  <li>Now, in Vim, type <code class="highlighter-rouge">:fin tr&lt;TAB&gt;</code> (<code class="highlighter-rouge">fin</code> is a short form for <code class="highlighter-rouge">find</code>) then hit ENTER.</li>
  <li>Check both the path and the working directory (using <code class="highlighter-rouge">:set path</code> and <code class="highlighter-rouge">:pwd</code> respectively).</li>
  <li>You can issue <code class="highlighter-rouge">:!blockMesh</code> while editing the file to rebuild the mesh.</li>
</ul>

<p>That’s it for now, the next post will explain ways to get the most of VIM compilers to
run <code class="highlighter-rouge">blockMesh</code> and OpenFOAM solvers on cases right from inside VIM and browse errors.</p>

  </article>
  
  

<div class="post-comments">
  <div id="disqus_thread"></div>
  <script type="text/javascript">
      var disqus_shortname = 'foamscience'; // required: replace example with your forum shortname
      (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
  </script>
</div>





</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="/assets/img/FoamScience/foamscience-logo-400x400-transparent.jpg" alt="M. Elwardi Fadeli">
  <div class="col-box-title name">M. Elwardi Fadeli</div>
  <p></p>
  <p class="contact">
    
    <a href="https://github.com/FoamScience">GitHub</a>
    
    
    
    <a href="mailto:elwardifadeli@gmail.com">Email</a>
    
    <a href="https://linkedin.com/in/elwardi-fadeli">LinkedIn</a>
    
  </p>
</div>

<div class="col-box">
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- SideAds -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3635214305281166"
     data-ad-slot="8889675473"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>

  <div class="col-box-title">Newest Posts</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/vim-openfoam-power-part2/">Customize VIM to work efficiently with OpenFOAM - Part 2</a></li>
    
      <li><a class="post-link" href="/vim-openfoam-power-part1/">Customize VIM to work efficiently with OpenFOAM - Part 1</a></li>
    
      <li><a class="post-link" href="/openscad-stock-tank-model/">Stock-Tank mesh construction using OpenSCAD</a></li>
    
      <li><a class="post-link" href="/openscad-cfd-usage-examples/">OpenSCAD CFD-oriented Usage Examples</a></li>
    
      <li><a class="post-link" href="/openscad-transformations-boolean-operations/">OpenSCAD Transformations & Boolean Operations</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">TOC</div>
</div>

        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 M. Elwardi Fadeli
</div>
<span><a href="/terms-of-use/">Terms Of Use</a></span>
<span>|</span>
<span><a href="/terms-of-use/">Privacy Policy</a></span>
<div>
<span>
    <span style="padding:20px;">
        <p
        style="display:block;margin-left:auto;margin-right:auto;width:500px;font-size:12px;"> 
  The <a href="http://www.openfoam.com/legal/trademark-policy.php">
      trade mark of the OPENFOAM</a> 
  name is held by <a href="http://openfoam.com/">ESI-OpenCFD</a>. 
  At the moment, this offering
  is not approved or endorsed by OpenCFD Limited, producer and distributor of the OpenFOAM
  software and owner of the OPENFOAM® and OpenCFD® trade marks. 
  </p>
  </span>     
</span>
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>


  </body>

</html>
